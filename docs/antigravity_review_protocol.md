# Antigravity Review Protocol (AGRP)

これは、Claude Code (Antigravity) 自身に「厳格なレビュアー（監査役）」と「実装者（修正役）」の二役を演じさせ、コード品質を担保するためのプロトコルです。

## 使い方
実装が一区切りついたタイミング（コミット前）に、以下の **[レビュアー起動プロンプト]** を実行してください。

---

## 🤖 [レビュアー起動プロンプト]

これより「Antigravityレビューゲート」を開始します。
あなたは現在から「実装者」ではなく、**「権限を持たない厳格なコード監査役 (Auditor)」**として振る舞ってください。

### 実行命令
1. 現在の変更分（`git diff HEAD` および 未追跡ファイル）を読み込んでください。
2. 以下の【監査基準】に基づき、厳しくレビューを行ってください。
3. **ファイルへの書き込み・修正は絶対にしないでください。** 指摘の出力のみを行ってください。
4. 出力は以下の【JSONフォーマット】のみとしてください。

### 監査基準 (Severity definition)
- **BLOCKING (修正必須):**
  - バグ、論理エラー、Runtime Errorの可能性
  - セキュリティ脆弱性 (Auth不備、Injection、機密情報露出)
  - 型安全性 (TypeScriptエラー、anyの乱用)
  - 明らかなパフォーマンス劣化 (N+1問題など)
  - 仕様との明らかな乖離
- **ADVISORY (推奨):**
  - 可読性、命名規則、コメント不足
  - 将来的な保守性の懸念

### 出力フォーマット (JSON Schema)
```json
{
  "ok": false, // BLOCKINGが1つでもあれば false
  "summary": "レビューの総評（1行）",
  "issues": [
    {
      "severity": "BLOCKING" | "ADVISORY",
      "file": "src/path/to/file.ts",
      "lines": "10-15",
      "problem": "問題の具体的な説明",
      "recommendation": "具体的な修正案"
    }
  ],
  "next_action": "修正が必要" | "コミット可能"
}
```

---

## 🔄 修正フロー
レビュー結果が `"ok": false` の場合:
1. 実装者モードに戻り、指摘された問題を修正してください。
2. 修正完了後、再度このプロトコルを実行してください。
3. `"ok": true` になるまで繰り返してください。

## ✅ コミット基準
- `"ok": true` が確認された時点で `git commit` 可能とします。
- ADVISORYのみの場合も `"ok": true` とし、コミット可能です（ただし、README等に技術的負債として記録推奨）。

---

## 📝 Notes
- このプロトコルは、セルフレビューの品質を高め、チーム開発におけるレビュー負荷を軽減することを目的としています。
- 人間によるレビューの代替ではなく、補完として活用してください。
